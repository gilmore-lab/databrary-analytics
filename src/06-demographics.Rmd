# Participant demographics

## Purpose

To summarize the demographic characteristics of participants in shared volumes on Databrary.

## Load data

### Demographic data 

```{r, message=FALSE, warning=FALSE}
library(targets)
targets::tar_load(volume_demog_df, store = "../_targets")
```

### Owner data

All owners.

:::

**TODO**: Fix importing of owners data.

:::

```{r import-saved-owners, message=FALSE, warning=FALSE, eval=FALSE}
owner_df <- load_owner_csvs("csv", fn_suffix = "-owners")  
```

::: {.rmdnote}

The session-level CSV data are stored in a local directory that is **not** synched with GitHub.
To generate the report, one must generate and save the data locally.

:::

## Summary results

### Overall

Databrary has demographic data for $n=$ `r sum(!is.na(demo_df$participant_ID))` individual participants.

```{r add-databrary-volume-url}
demo_df <- volume_demog_df %>%
  dplyr::mutate(., vol_url = paste0("https://nyu.databrary.org/volume/", as.numeric(vol_id)))
```

### Age

#### Volumes and session 

```{r create-age}
age_df <- demo_df %>%
  dplyr::filter(., !is.na(age_days)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

age_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)  
```

#### Histogram

```{r}
demo_df %>%
  dplyr::filter(., age_days <= 365.24*5) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (weeks) for 5-year-olds and younger")
```

```{r}
demo_df %>%
  dplyr::filter(., age_days > 365.24*5,
                age_days <= 365.24*15) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (weeks) for 5-15 year-olds")
```

```{r}
demo_df %>%
  dplyr::filter(., age_days > 365.24*15) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (weeks) 15+ year-olds")
```

### Gender

#### Volumes and sessions

```{r gender-volumes}
gender_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_gender)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

gender_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(gender_df$n_vols_w_demo)` volumes reporting `participant_gender`.

#### Number of participants

```{r gender-table}
xtabs(formula = ~ participant_gender, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

### Race

#### Volumes and sessions

```{r race-volumes}
race_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_race)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

race_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(race_df$n_vols_w_demo)` volumes reporting `participant_race`.

#### Number of participants

```{r race-table}
xtabs(formula = ~ participant_race, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

### Ethnicity

#### Volumes and sessions

```{r ethnicity-volumes}
ethnicity_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_ethnicity)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

ethnicity_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(ethnicity_df$n_vols_w_demo)` volumes reporting `participant_ethnicity`.

#### Number of participants

```{r ethnicity-table}
xtabs(formula = ~ participant_ethnicity, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```



### Participant language

#### Volumes and sessions

```{r language-volumes}
language_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_language)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

language_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(language_df$n_vols_w_demo)` volumes reporting `participant_language`.

#### Number of participants

```{r language-table}
xtabs(formula = ~ participant_language, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```



### Pregnancy term

#### Volumes and sessions

```{r pregnancy-term-volumes}
participant_pregnancy_term_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_pregnancy_term)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_pregnancy_term_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_pregnancy_term_df$n_vols_w_demo)` volumes reporting `participant_pregnancy_term`.

#### Number of participants

```{r pregnancy-term-table}
xtabs(formula = ~ participant_pregnancy_term, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```



### Birthweight

#### Volumes and sessions

```{r birthweight-volumes}
participant_birth_weight_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_birth_weight)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_birth_weight_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_birth_weight_df$n_vols_w_demo)` volumes reporting `participant_birth_weight`.

#### Number of participants

```{r birthweight-table}
xtabs(formula = ~ participant_birth_weight, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

```{r}
demo_df %>%
  ggplot() +
  aes(x = as.numeric(participant_birth_weight)) +
  geom_histogram(bins = 15)
```

### Disability

#### Volumes and sessions

```{r participant_disability-volumes}
participant_disability_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_disability)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_disability_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_disability_df$n_vols_w_demo)` volumes reporting `participant_disability`.

#### Number of participants

```{r disability-table}
xtabs(formula = ~ participant_disability, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

