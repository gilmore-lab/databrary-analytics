# Participant demographics

This report summarizes the demographic characteristics of participants in shared volumes on Databrary.

```{r, message=FALSE, warning=FALSE}
targets::tar_load(volume_demog_df, store = "../_targets")
demo_df <- volume_demog_df
```

### Owner data  {-}

All owners.

::: {.rmdnote}

**TODO**: Fix importing of owners data.

:::

```{r import-saved-owners, message=FALSE, warning=FALSE, eval=FALSE}
owner_df <- load_owner_csvs("csv", fn_suffix = "-owners")  
```

::: {.rmdnote}

The session-level CSV data are stored in a local directory that is **not** synched with GitHub.
To generate the report, one must generate and save the data locally.

:::

## Overall {-}

Databrary has demographic data for ~ $n=$ `r sum(!is.na(demo_df$participant_ID))` individual participant-sessions.
This number is an underestimate because the number of unshared volumes is 3-4x the number of shared volumes.

```{r add-databrary-volume-url}
demo_df <- volume_demog_df %>%
  dplyr::mutate(., vol_url = paste0("https://nyu.databrary.org/volume/", as.numeric(vol_id)))
```

## Age {-}

### Volumes and session  {-}

```{r create-age}
age_df <- demo_df %>%
  dplyr::filter(., !is.na(age_days)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

age_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)  
```

There are `r unique(age_df$n_vols_w_demo)` volumes reporting `age_days`.

### Number of participants and age distribution  {-}

The following summarizes the number of individual participant-sessions for whom there are data.

```{r summarize-age}
age_df <- demo_df %>%
  dplyr::mutate(., age_grp = cut(as.numeric(demo_df$age_days), c(0, 90, 180, 365.25, 2*365.25, 3*365.25, 4*365.25, 5*365.25, 15*365.25, 20*365.25, 25*365.25, 100*365.25), c("<3m", "3-6m", "6m-1y", "1-2y", "2-3y", "3-4y", "4-5y", "5-15y", "15-20y", "20-25y", ">25y")))

xtabs(formula = ~ age_grp, data = age_df)
```

```{r under-5y-hist, fig.cap="Age distribution of < 5yrs"}
demo_df %>%
  dplyr::filter(., age_days <= 365.24*5) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (days) for 5-year-olds and younger")
```

```{r 5y-15y-hist, fig.cap="Age distribution of 5-15 year-olds"}
demo_df %>%
  dplyr::filter(., age_days > 365.24*5,
                age_days <= 365.24*15) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (days) for 5-15 year-olds")
```

```{r 15y-plus-hist, fig.cap="Age distribution of 15+ year-olds"}
demo_df %>%
  dplyr::filter(., age_days > 365.24*15) %>%
  ggplot() +
  aes(age_days) +
  geom_histogram() +
  ggtitle("Age at test (days) 15+ year-olds")
```

## Gender {-}

### Volumes and sessions {-}

```{r gender-volumes}
gender_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_gender)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

gender_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(gender_df$n_vols_w_demo)` volumes reporting `participant_gender`.

### Number of participants {-}

```{r gender-table}
xtabs(formula = ~ participant_gender, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

## Race {-}

### Volumes and sessions {-}

```{r race-volumesE}
race_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_race)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

race_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(race_df$n_vols_w_demo)` volumes reporting `participant_race`.

### Number of participants {-}

```{r race-table,}
xtabs(formula = ~ participant_race, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

## Ethnicity {-}

### Volumes and sessions {-}

```{r ethnicity-volumes}
ethnicity_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_ethnicity)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

ethnicity_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(ethnicity_df$n_vols_w_demo)` volumes reporting `participant_ethnicity`.

### Number of participants {-}

```{r ethnicity-table}
xtabs(formula = ~ participant_ethnicity, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

## Participant language {-}

### Volumes and sessions {-}

```{r language-volumes}
language_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_language)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

language_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(language_df$n_vols_w_demo)` volumes reporting `participant_language`.

### Number of participants {-}

```{r language-table}
xtabs(formula = ~ participant_language, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

## Pregnancy term {-}

### Volumes and sessions {-}

```{r pregnancy-term-volumes}
participant_pregnancy_term_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_pregnancy_term)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_pregnancy_term_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_pregnancy_term_df$n_vols_w_demo)` volumes reporting `participant_pregnancy_term`.

### Number of participants {-}

```{r pregnancy-term-table}
xtabs(formula = ~ participant_pregnancy_term, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

## Birthweight {-}

### Volumes and sessions {-}

```{r birthweight-volumes}
participant_birth_weight_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_birth_weight)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_birth_weight_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_birth_weight_df$n_vols_w_demo)` volumes reporting `participant_birth_weight`.

### Number of participants {-}

```{r birthweight-table}
xtabs(formula = ~ participant_birth_weight, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

### Histogram {-}

```{r birthweight-hist}
demo_df %>%
  ggplot() +
  aes(x = as.numeric(participant_birth_weight)) +
  geom_histogram(bins = 15)
```

## Disability {-}

### Volumes and sessions {-}

```{r participant_disability-volumes}
participant_disability_df <- demo_df %>%
  dplyr::filter(., !is.na(participant_disability)) %>%
  dplyr::group_by(., vol_id, vol_url) %>%
  dplyr::summarize(., n_sessions = n()) %>%
  dplyr::ungroup(.) %>%
  dplyr::mutate(., n_vols_w_demo = n())

participant_disability_df %>%
  dplyr::select(., vol_id, vol_url, n_sessions) %>%
  dplyr::arrange(., desc(n_sessions)) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

There are `r unique(participant_disability_df$n_vols_w_demo)` volumes reporting `participant_disability`.

### Number of participants {-}

```{r disability-table}
xtabs(formula = ~ participant_disability, data = demo_df) %>%
  knitr::kable(., "html") %>%
  kableExtra::kable_styling(.)
```

::: {.rmdnote}

**TODO**: Add section to summarize state or country info.

:::
