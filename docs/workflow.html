<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow | Databrary analytics</title>
<meta name="author" content="Rick Gilmore &amp; Andrea Seisler">
<meta name="description" content="This page describes the set of tools we use to generate these data and present them in this site. GitHub We use GitHub’s pages feature to serve the web site files. At present, we are using a...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Workflow | Databrary analytics">
<meta property="og:type" content="book">
<meta property="og:description" content="This page describes the set of tools we use to generate these data and present them in this site. GitHub We use GitHub’s pages feature to serve the web site files. At present, we are using a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Workflow | Databrary analytics">
<meta name="twitter:description" content="This page describes the set of tools we use to generate these data and present them in this site. GitHub We use GitHub’s pages feature to serve the web site files. At present, we are using a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="include/css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Databrary analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="weekly.html"><span class="header-section-number">2</span> Weekly</a></li>
<li><a class="" href="investigators-and-institutions.html"><span class="header-section-number">3</span> Investigators and Institutions</a></li>
<li><a class="" href="tags-and-keywords.html"><span class="header-section-number">4</span> Tags and keywords</a></li>
<li><a class="" href="funders.html"><span class="header-section-number">5</span> Funders</a></li>
<li><a class="" href="assets.html"><span class="header-section-number">6</span> Assets</a></li>
<li><a class="" href="participant-demographics.html"><span class="header-section-number">7</span> Participant demographics</a></li>
<li><a class="" href="shared-volumes-and-sessions.html"><span class="header-section-number">8</span> Shared volumes and sessions</a></li>
<li class="book-part">Appendix</li>
<li><a class="active" href="workflow.html">Workflow</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/gilmore-lab/databrary-analytics">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflow" class="section level1 unnumbered">
<h1>Workflow<a class="anchor" aria-label="anchor" href="#workflow"><i class="fas fa-link"></i></a>
</h1>
<p>This page describes the set of tools we use to generate these data and present them in this site.</p>
<div id="github" class="section level2 unnumbered">
<h2>GitHub<a class="anchor" aria-label="anchor" href="#github"><i class="fas fa-link"></i></a>
</h2>
<p>We use GitHub’s pages feature to serve the web site files.</p>
<p>At present, we are using a repository associated with Rick Gilmore’s lab group (<a href="https://github.com/gilmore-lab/databrary-analytics/" class="uri">https://github.com/gilmore-lab/databrary-analytics/</a>).
Once the migration to the <code>bookdown</code> package is complete, we will move the repo to the Databrary organization on GitHub.
That will result in the analytics site having the following url: <a href="https://databrary.github.io/analytics/" class="uri">https://databrary.github.io/analytics/</a>.</p>
<p>The site is built locally by Rick Gilmore or Andrea Seisler, then pushed to GitHub.</p>
</div>
<div id="rstudio" class="section level2 unnumbered">
<h2>RStudio<a class="anchor" aria-label="anchor" href="#rstudio"><i class="fas fa-link"></i></a>
</h2>
<p>We use <a href="https://posit.co/products/open-source/rstudio/">RStudio</a> as the integrated development environment for the site.
Most of the code is in R Markdown and R, with some CSS and JavaScript.</p>
<p>We use a number of R packages in the workflow.</p>
<div id="databrary-api" class="section level3 unnumbered">
<h3>Databrary API<a class="anchor" aria-label="anchor" href="#databrary-api"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://github.com/PLAY-behaviorome/databraryapi/"><code>databraryapi</code> package</a> provides a set of tools for interacting with the Databrary API and gathering data from the site.
This package may be useful to some analysts whether or not they care about Databrary-specific analytics.</p>
<p>Most data and metadata used in these reports can be accessed by the public, but specific data about individual participants requires that the user be authorized and logged in to the site using the <code>databraryapi::db_login()</code> function.</p>
<p>The package may be installed via <code>devtools::install_github(repo="PLAY-behaviorome/databraryapi")</code>.</p>
<p>See <a href="https://play-behaviorome.github.io/databraryapi/" class="uri">https://play-behaviorome.github.io/databraryapi/</a> for documentation about the package.</p>
</div>
<div id="targets" class="section level3 unnumbered">
<h3>Targets<a class="anchor" aria-label="anchor" href="#targets"><i class="fas fa-link"></i></a>
</h3>
<p>We use the <a href="https://books.ropensci.org/targets/"><code>targets</code></a> package to generate data and metadata files that are used to create the visualizations and summaries.</p>
<p>Some of the components are rendered on a regular, time-determined basis, like the weekly report. Others are rendered less often, typically quarterly.</p>
<p>Most of the targets call functions in <code>R/functions.R</code>. The specific targets can be viewed in the <code>_targets.R</code> file in the root directory of the repository.</p>
<p>A typical workflow to ‘make’ or update the <em>data</em> files, is as follows:</p>
<pre><code><a href="https://docs.ropensci.org/targets/">library(targets)
tar_make()</a></code></pre>
</div>
<div id="bookdown" class="section level3 unnumbered">
<h3>Bookdown<a class="anchor" aria-label="anchor" href="#bookdown"><i class="fas fa-link"></i></a>
</h3>
<p>To generate the site, we use the <a href="https://bookdown.org/yihui/bookdown/"><code>bookdown</code></a> package.</p>
<p>A typical sequence of commands to regenerate the site is the following:</p>
<pre><code>bookdown::render_book('src')</code></pre>
<p>Configuration files using the YAML markup language control the rendering process.
These files and the source R Markdown (.Rmd) files used to generate the site are in the <code>src/</code> directory.</p>
<p>The rendering command creates a full website in the <code>docs/</code> directory.</p>
</div>
<div id="package-reproducibility" class="section level3 unnumbered">
<h3>Package Reproducibility<a class="anchor" aria-label="anchor" href="#package-reproducibility"><i class="fas fa-link"></i></a>
</h3>
<p>We use the <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a> package to track package dependencies.</p>
</div>
</div>
<div id="strategy" class="section level2 unnumbered">
<h2>Strategy<a class="anchor" aria-label="anchor" href="#strategy"><i class="fas fa-link"></i></a>
</h2>
<p>Some of the data elements in the report change often, but others do not.
We have found it is faster and more convenient in many cases to download various data files from Databrary and store copies as comma-separated value (CSV) text files in <code>src/csv</code>.</p>
<p>Some of the CSVs contain potentially identifiable human subjects data, so we use a special <code>.gitignore</code> file to keep those files out of the git tracking scheme and prevent uploading them to GitHub.</p>
<p>These data analyses and visualizations have developed piecemeal over several years.
They could undoubtedly be optimized and improved.</p>
<p>The primary developer (Rick Gilmore) has had a ‘git-er-done’ attitude toward the project, especially with the latest refactoring to <a href="https://github.com/rstudio/bookdown">bookdown</a>, <a href="https://docs.ropensci.org/targets/">targets</a>, and <a href="https://rstudio.github.io/renv/">renv</a>.</p>
<p>Gilmore takes some solace in the following quotation from the father of literate programming, <a href="https://en.wikiquote.org/wiki/Donald_Knuth">Donald Knuth</a>:</p>
<blockquote>
<p>…the real problem is that programmers have spent far too much time worrying about efficiency in the wrong places and at the wrong times; premature optimization is the root of all evil (or at least most of it) in programming.</p>
</blockquote>
<div id="roadmap" class="section level3 unnumbered">
<h3>Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Migrate ARS to <code>bookdown</code> branch; merge into main (March 2023).</li>
<li>Fix when targets are run for which flows.
<ul>
<li>This is a work in-progress.</li>
</ul>
</li>
<li>Separate functions in <code>R/functions.R</code> into separate files based on their context. The current <code>R/functions.R</code> contains mostly old code from the pre-<code>bookdown</code> version of the site. The styles are inconsistent and the large file is hard to maintain.
<ul>
<li>This is in-process as of 2023-02-24.</li>
</ul>
</li>
<li>Devise visualizations of assets by investigator/institution.</li>
<li>
<del>Function to determine max party_id and max volume_id interactively</del>.</li>
<li>Eliminate YAML params from <code>index.Rmd</code>.</li>
<li>Create JSON lat, lon file for Databrary home page.</li>
<li>
<del>Add state, country summaries to demographics</del>.</li>
<li>Allow user to show code.</li>
<li>Move from old pipe <code>%&gt;%</code> to new <code>|&gt;</code>.
<ul>
<li>
<del>Done for <code>*.Rmd</code> files</del>, but not <code>*.R</code> files as of 2023-02-24.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="shared-volumes-and-sessions.html"><span class="header-section-number">8</span> Shared volumes and sessions</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflow">Workflow</a></li>
<li><a class="nav-link" href="#github">GitHub</a></li>
<li>
<a class="nav-link" href="#rstudio">RStudio</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#databrary-api">Databrary API</a></li>
<li><a class="nav-link" href="#targets">Targets</a></li>
<li><a class="nav-link" href="#bookdown">Bookdown</a></li>
<li><a class="nav-link" href="#package-reproducibility">Package Reproducibility</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#strategy">Strategy</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#roadmap">Roadmap</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/gilmore-lab/databrary-analytics/blob/main/src/10-workflow.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/gilmore-lab/databrary-analytics/edit/main/src/10-workflow.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Databrary analytics</strong>" was written by Rick Gilmore &amp; Andrea Seisler. It was last built on 2023-06-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
