<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Rick O. Gilmore" />


<title>Databrary Report</title>

<script src="databrary_weekly_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="databrary_weekly_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="databrary_weekly_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="databrary_weekly_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="databrary_weekly_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="databrary_weekly_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="databrary_weekly_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="databrary_weekly_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="databrary_weekly_files/navigation-1.1/tabsets.js"></script>
<script src="databrary_weekly_files/navigation-1.1/codefolding.js"></script>
<link href="databrary_weekly_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="databrary_weekly_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Databrary Report</h1>
<h4 class="author"><em>Rick O. Gilmore</em></h4>
<h4 class="date"><em>2019-02-28 17:03:38</em></h4>

</div>


<div id="institutions-authorized-users" class="section level1">
<h1><span class="header-section-number">1</span> Institutions &amp; Authorized Users</h1>
<p>At the moment, the <code>old_stats</code> come from a CSV stored locally. Once we have API commands to upload new data, the <code>old_stats</code> can come from Databrary directly.</p>
<pre class="r"><code>new_stats &lt;- databraryapi::get_db_stats()

old_stats &lt;- read_csv(&quot;csv/institutionAuthCounts.csv&quot;)

# initialize updated_stats
updated_stats &lt;- old_stats
next_entry &lt;- dim(updated_stats)[1] + 1
updated_stats[next_entry,] = NA

# fill with new data
updated_stats$YearMonth[next_entry] &lt;- new_stats$date
updated_stats$Institutions[next_entry] &lt;- new_stats$institutions
updated_stats$`Authorized Investigators`[next_entry] &lt;- new_stats$investigators

# hate the variable names
updated_stats &lt;- 
  updated_stats %&gt;%
  rename(date = YearMonth, institutions = Institutions, investigators = `Authorized Investigators`)</code></pre>
<pre class="r"><code>updated_stats &lt;- updated_stats %&gt;%
  gather(., key = &quot;type&quot;, value = &quot;count&quot;, -date)

# Plot
p &lt;- updated_stats %&gt;%
  ggplot(., aes(x = date, y = count, color = type, group = type)) +
  geom_point() + 
  geom_line(size=3) +
  theme_classic(base_size = 14) +                        #Axis Label Size
  scale_colour_manual(values=c(&quot;#ec7751&quot;, &quot;#4CAE99&quot;)) +  #Saturated Databrary Colors 
  ylab(&quot;Authorizations&quot;) +
  #xlab(&quot;Year&quot;) +
  #labs(title=&quot;Databrary User Growth&quot;) +
  theme(axis.title.x=element_blank()) +
  theme(legend.position=&quot;none&quot;, axis.text = element_text(size = rel(0.8), colour = &quot;black&quot;)) +    #Axis text size and color
  theme(axis.line = element_blank()) +
  scale_y_continuous(breaks = seq(0, 900, 100), expand = c(0,0)) +
  coord_cartesian(ylim = c(0, 900))
  
ggdraw(p) + 
  draw_label(&quot;Investigators&quot;, colour = &quot;#4CAE99&quot;, .9, .73) +
  draw_label(&quot;Institutions&quot;, colour = &quot;#ec7751&quot;, .9, .38)</code></pre>
<p><img src="databrary_weekly_files/figure-html/db-inst-user-plot-1.png" width="672" /></p>
</div>
<div id="volumes" class="section level1">
<h1><span class="header-section-number">2</span> Volumes</h1>
<p>The volumes data can also be rewritten back to Databrary at some future date.</p>
<pre class="r"><code>old_vols &lt;- read_csv(&quot;csv/db-volumes-monthly.csv&quot;)

# Update
updated_vols &lt;- old_vols
next_entry &lt;- dim(updated_vols)[1] + 1
updated_vols[next_entry,] = NA

updated_vols$date[next_entry] &lt;- new_stats$date
updated_vols$shared_volumes[next_entry] &lt;- new_stats$datasets.shared
updated_vols$unshared_volumes[next_entry] &lt;- 
  new_stats$datasets.total - new_stats$datasets.shared</code></pre>
<pre class="r"><code>updated_vols &lt;- updated_vols %&gt;%
  gather(., key = &quot;type&quot;, value = &quot;count&quot;, -date)

# Plot
vols_plot &lt;- updated_vols %&gt;%
  ggplot(., aes(x = date, y = count, color = type, group = type)) +
  geom_point() + 
  geom_line(size=3) +
  theme_classic(base_size = 14) +                        #Axis Label Size
  scale_colour_manual(values=c(&quot;#ec7751&quot;, &quot;#4CAE99&quot;)) +  #Saturated Databrary Colors 
  ylab(&quot;Volumes&quot;) +
  #xlab(&quot;Year&quot;) +
  #labs(title=&quot;Databrary Citation Growth&quot;) +
  theme(axis.title.x=element_blank()) +
  theme(legend.position=&quot;none&quot;, axis.text = element_text(size = rel(0.8), colour = &quot;black&quot;)) +    #Axis text size and color
  theme(axis.line = element_blank()) +
  scale_y_continuous(breaks = seq(0, 500, 100), expand = c(0,0)) +
  coord_cartesian(ylim = c(0, 500))
  
  
ggdraw(vols_plot) + 
  draw_label(&quot;Unshared&quot;, colour = &quot;#4CAE99&quot;, .86, .88) +
  draw_label(&quot;Shared&quot;, colour = &quot;#ec7751&quot;, .84, .65)</code></pre>
<p><img src="databrary_weekly_files/figure-html/db-vols-plot-1.png" width="672" /></p>
</div>
<div id="citation-counts" class="section level1">
<h1><span class="header-section-number">3</span> Citation counts</h1>
<p>This section will eventually update and show the citation counts for Databrary and Datavyu. For now, it just shows the stored data file that we update manually. This can be automated, we just have to write a function to parse the HTML returned from Google Scholar to pull the relevant data.</p>
<!-- Here we plot all Databrary and Datavyu Citations vs. date. I used https://www.hexcolortool.com to saturate the Databrary colors ("#fadbc7", "#b2ddd4") so they are darker on the graph. -->
<pre class="r"><code>citations &lt;- read_csv(&quot;csv/citations-monthly.csv&quot;)

citations &lt;- citations %&gt;%
  gather(., key = &quot;type&quot;, value = &quot;count&quot;, -date)

# Plot
citations_plot &lt;- 
  citations %&gt;%
  ggplot(., aes(x = date, y = count, color = type, group = type)) +
  geom_point() + 
  geom_line(size=3) +
  theme_classic(base_size = 14) +                        #Axis Label Size
  scale_colour_manual(values=c(&quot;#ec7751&quot;, &quot;#4CAE99&quot;)) +  #Saturated Databrary Colors 
  ylab(&quot;Citations&quot;) +
  #xlab(&quot;Year&quot;) +
  #labs(title=&quot;Databrary Citation Growth&quot;) +
  theme(axis.title.x=element_blank()) +
  theme(legend.position=&quot;none&quot;, axis.text = element_text(size = rel(0.8), colour = &quot;black&quot;)) +    #Axis text size and color
  theme(axis.line = element_blank()) +
  scale_y_continuous(breaks = seq(0, 250, 50), expand = c(0,0)) +
  coord_cartesian(ylim = c(0, 250))
  
ggdraw(citations_plot) + 
  draw_label(&quot;Datavyu&quot;, colour = &quot;#4CAE99&quot;, .9, .6) +
  draw_label(&quot;Databrary&quot;, colour = &quot;#ec7751&quot;, .7, .85)</code></pre>
<p><img src="databrary_weekly_files/figure-html/db-dv-citations-plot-1.png" width="672" /></p>
</div>
<div id="data-about-volumes-with-videos" class="section level1">
<h1><span class="header-section-number">4</span> Data about volumes with videos</h1>
<pre class="r"><code># List files with metadata
csv_files &lt;- list.files(path = &quot;csv&quot;, pattern = &quot;vol_&quot;, full.names = TRUE)

# Extract vector of volume numbers, determine the maximum
vol_nums &lt;- stringr::str_match(csv_files, pattern = &quot;_([0-9]+)\\.&quot;)
vol_ids &lt;- as.numeric(vol_nums[,2])
last_vol &lt;- max(vol_ids)
vols_to_test &lt;- params$vols_to_test

# Create function to write new data files for each volum
write_vid_csv &lt;- function(vol.id = 1) {
  message(paste0(&quot;Getting data for volume &quot;, vol.id))
  vid_dat &lt;- get_video_stats(vol.id)
  # This .Rmd file is already in working/
  if (!is.null(vid_dat)) {
    write.csv(vid_dat, file = paste0(&quot;csv/vol_&quot;, vol.id, &quot;.csv&quot;),
              row.names = FALSE)
  }
} </code></pre>
<pre class="r"><code>lapply(last_vol:(last_vol + vols_to_test), write_vid_csv)</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]
## NULL
## 
## [[6]]
## NULL
## 
## [[7]]
## NULL
## 
## [[8]]
## NULL
## 
## [[9]]
## NULL
## 
## [[10]]
## NULL
## 
## [[11]]
## NULL</code></pre>
<pre class="r"><code>vol_files &lt;- list.files(&quot;csv&quot;, pattern = &quot;vol_[0-9]+&quot;, full.names = TRUE)

# Import the individual csv files
video_data &lt;- lapply(vol_files, read_csv)
video_stats &lt;- Reduce(function(x,y) merge(x, y, all = TRUE), video_data)</code></pre>
<p>The median number of videos per volume is 16 with a range of [1, 4368].</p>
<pre class="r"><code>vols &lt;- video_stats$vol_id
vol_info &lt;- lapply(vols, list_volume_metadata)
vols_data &lt;- Reduce(function(x,y) merge(x, y, all = TRUE), vol_info)
vols_joined &lt;- dplyr::left_join(vols_data, video_stats, by = c(&quot;vol_id&quot; = &quot;vol_id&quot;))</code></pre>
<!-- NB: -->
<!-- Permission 2: Access via Databrary sharing only -->
<!-- Permission 3: Non-named collaborator (through X?) -->
<!-- Permission 4: Named collaborator -->
<!-- Permission 5: Investigator, Volume overview shared OR Private -->
<!-- I need to dig in to determine what variable depicts the sharing level. -->
<!-- For now, let's note that volumes with permission == 2 are available to all Databrary users. -->
<!-- Volumes with a DOI have partial information available to all Databrary users. -->
<p>There are 119 volumes with DOIs (shared) that have sessions and at least one video as of today (2019-02-28 17:04:16).</p>
<!-- Let's export a CSV of these. -->
<!-- ```{r} -->
<!-- shared_vols_w_video <- vols_joined %>%  -->
<!--   dplyr::filter(doi != "NA") -->
<!-- write.csv(shared_vols_w_video, file = "shared_vols_w_video_2018-12-28.csv", row.names = FALSE) -->
<!-- ``` -->
<div id="number-of-videos-in-a-shared-volume" class="section level2">
<h2><span class="header-section-number">4.1</span> Number of videos in a (shared) volume</h2>
<pre class="r"><code>vols_joined %&gt;%
  filter(!is.na(doi)) %&gt;%
  ggplot(.) +
  aes(x=n_videos)+
  geom_histogram()</code></pre>
<p><img src="databrary_weekly_files/figure-html/n-vids-shared-vols-1.png" width="672" /></p>
</div>
<div id="number-of-sessions-in-a-shared-volume" class="section level2">
<h2><span class="header-section-number">4.2</span> Number of sessions in a (shared) volume</h2>
<pre class="r"><code>vols_joined %&gt;%
  filter(!is.na(doi)) %&gt;%
  ggplot(.) +
  aes(x=n_sessions)+
  geom_histogram()</code></pre>
<p><img src="databrary_weekly_files/figure-html/n-sessions-shared-vols-1.png" width="672" /></p>
</div>
<div id="total-video-hours-in-a-shared-volume" class="section level2">
<h2><span class="header-section-number">4.3</span> Total video hours in a (shared) volume</h2>
<pre class="r"><code>vols_joined %&gt;%
  filter(!is.na(doi)) %&gt;%
  ggplot(.) +
  aes(x=tot_hrs)+
  geom_histogram()</code></pre>
<p><img src="databrary_weekly_files/figure-html/tot-hrs-shared-vols-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
